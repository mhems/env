#!/bin/bash

sink=1
file=~/.i3/.volume

if [ -f $file ]
then
    vol=`head -1 $file | perl -ne 'm/(\d+)/; print "$1"; exit;'`
    echo "file holds: $vol" >> ~/log
    [ -n $vol ] && pactl set-sink-volume $sink "$vol%"
    rm -f $file
    echo "unmute to $vol" >> ~/log
else
    echo "perl got `amixer -c $sink -M -D pulse get Master`" >> ~/log
    vol=`amixer -c $sink -M -D pulse get Master \
           | perl -ne 'if (m/\[(\d+)%\]/) { print "$1\n"; exit; }'`
    [ -n $vol ] && echo $vol > $file
    pactl set-sink-volume $sink 0
    echo "mute, save $vol" >> ~/log
fi
